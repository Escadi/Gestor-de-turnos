
  /**
   * CONTADOR DE AUSENCIAS PENDIENTES 
   */
  get abencesPendingCount(): number {
    return this.abences.filter(a => a.status === 'Pendiente').length;
  }
  
  /**
   * ABSENCES MODAL FUNCTIONS
   */
  openAbenceModal() {
    this.isAbenceModalOpen = true;
    this.isEditAbenceModal = false;
    this.selectedAbence = null;
    this.newAbence = {
      idType: null,
      details: '',
      status: 'Pendiente',
      timeStart: new Date().toISOString(),
      timeEnd: new Date().toISOString()
    };
  }

  openEditAbenceModal(abence: any) {
    this.isAbenceModalOpen = true;
    this.isEditAbenceModal = true;
    this.selectedAbence = abence;
    this.newAbence = {
      idType: abence.idType,
      details: abence.details,
      status: abence.status,
      timeStart: abence.timeStart,
      timeEnd: abence.timeEnd
    };
  }

  closeAbenceModal() {
    this.isAbenceModalOpen = false;
    this.isEditAbenceModal = false;
    this.selectedAbence = null;
  }

  /**
   * CRUD FOR ABSENCES - CREATE
   */
  async submitAbence() {
    if (!this.newAbence.idType) {
      const alert = await this.alertCtrl.create({
        header: 'Campo requerido',
        message: 'Por favor selecciona el tipo de ausencia.',
        buttons: ['OK']
      });
      await alert.present();
      return;
    }

    const loading = await this.loadingCtrl.create({ message: 'Enviando...' });
    await loading.present();

    const formData = new FormData();
    formData.append('idWorker', this.currentUser.idWorker.toString());
    formData.append('idType', this.newAbence.idType.toString());
    formData.append('details', this.newAbence.details || '');
    formData.append('status', 'Pendiente');
    formData.append('timeStart', this.newAbence.timeStart);
    formData.append('timeEnd', this.newAbence.timeEnd);

    this.myServices.createAbence(formData).subscribe({
      next: () => {
        loading.dismiss();
        this.closeAbenceModal();
        this.loadData();
      },
      error: (err) => {
        loading.dismiss();
        console.error('Error al crear ausencia:', err);
      }
    });
  }

  /**
   * CRUD FOR ABSENCES - UPDATE
   */
  async updateAbence() {
    if (!this.newAbence.idType) {
      const alert = await this.alertCtrl.create({
        header: 'Campo requerido',
        message: 'Por favor selecciona el tipo de ausencia.',
        buttons: ['OK']
      });
      await alert.present();
      return;
    }

    const loading = await this.loadingCtrl.create({ message: 'Actualizando...' });
    await loading.present();

    const formData = new FormData();
    formData.append('idWorker', this.currentUser.idWorker.toString());
    formData.append('idType', this.newAbence.idType.toString());
    formData.append('details', this.newAbence.details || '');
    formData.append('status', this.newAbence.status);
    formData.append('timeStart', this.newAbence.timeStart);
    formData.append('timeEnd', this.newAbence.timeEnd);

    this.myServices.updateAbence(this.selectedAbence.id, formData).subscribe({
      next: () => {
        loading.dismiss();
        this.closeAbenceModal();
        this.loadData();
      },
      error: (err) => {
        loading.dismiss();
        console.error('Error al actualizar ausencia:', err);
      }
    });
  }

  /**
   * CRUD FOR ABSENCES - DELETE
   */
  async deleteAbence() {
    if (!this.selectedAbence) return;

    const alert = await this.alertCtrl.create({
      header: 'Confirmar eliminación',
      message: '¿Estás seguro de que deseas eliminar esta ausencia?',
      buttons: [
        { text: 'Cancelar', role: 'cancel' },
        {
          text: 'Eliminar',
          handler: async () => {
            const loading = await this.loadingCtrl.create({ message: 'Eliminando...' });
            await loading.present();

            this.myServices.deleteAbence(this.selectedAbence.id).subscribe({
              next: () => {
                loading.dismiss();
                this.closeAbenceModal();
                this.loadData();
              },
              error: (err) => {
                loading.dismiss();
                console.error('Error al eliminar ausencia:', err);
              }
            });
          }
        }
      ]
    });
    await alert.present();
  }
