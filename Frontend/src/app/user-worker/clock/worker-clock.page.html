<ion-header class="ion-no-border">
    <ion-toolbar>
        <div style="display: flex; align-items: center; padding-left: 10px;">
            <ion-img src="assets/TimeBeep-logo - clock.png"
                style="width: 30px; height: 30px; margin-right: 10px;"></ion-img>
            <ion-title style="padding: 0;">Time Beep</ion-title>
        </div>
        <ion-buttons slot="end" *ngIf="isAdmin">
            <ion-button color="warning" fill="solid" style="--border-radius: 8px;" routerLink="/admin">
                <ion-icon slot="start" name="shield-checkmark-outline"></ion-icon>
                Panel Admin
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
    <div class="clock-container">
        <!-- Estado Actual -->
        <ion-card class="status-card">
            <ion-card-content>
                <div class="time-display">
                    <h1>{{ currentTime }}</h1>
                    <p>{{ currentDate }}</p>
                    <p class="user-name" *ngIf="currentUser">
                        Hola, <strong>{{ currentUser.name }} {{ currentUser.surname }}</strong>
                    </p>
                </div>
                <!-- MAPA -->
                <div id="map" class="map-container"></div>
                <!-- FIN MAPA -->
                <div class="status-badge" [class.clocked-in]="isClockedIn">
                    <ion-icon [name]="isClockedIn ? 'checkmark-circle' : 'time'" size="large"></ion-icon>
                    <h2>{{ isClockedIn ? 'Fichado' : 'No Fichado' }}</h2>
                </div>
            </ion-card-content>
        </ion-card>

        <!-- Botones de Fichaje -->
        <div class="action-buttons">
            <ion-button expand="block" size="large" color="success" (click)="clockIn()" [disabled]="isClockedIn">
                <ion-icon slot="start" name="log-in-outline"></ion-icon>
                Fichar Entrada
            </ion-button>

            <ion-button expand="block" size="large" color="danger" (click)="clockOut()" [disabled]="!isClockedIn">
                <ion-icon slot="start" name="log-out-outline"></ion-icon>
                Fichar Salida
            </ion-button>
        </div>

        <!-- Última Actividad -->
        <ion-card *ngIf="lastAction">
            <ion-card-header>
                <ion-card-title>Última Actividad</ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <ion-list lines="none">
                    <ion-item>
                        <ion-icon name="time-outline" slot="start"></ion-icon>
                        <ion-label>
                            <p>Acción</p>
                            <h3>{{ lastAction.type }}</h3>
                        </ion-label>
                    </ion-item>
                    <ion-item>
                        <ion-icon name="calendar-outline" slot="start"></ion-icon>
                        <ion-label>
                            <p>Fecha y Hora</p>
                            <h3>{{ lastAction.datetime }}</h3>
                        </ion-label>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>

        <!-- Resumen del Día -->
        <ion-card>
            <ion-card-header>
                <ion-card-title>Resumen de Hoy</ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <ion-list lines="none">
                    <ion-item>
                        <ion-icon name="time-outline" slot="start" color="primary"></ion-icon>
                        <ion-label>
                            <p>Horas Trabajadas</p>
                            <h3>{{ hoursWorked }} horas</h3>
                        </ion-label>
                    </ion-item>
                    <ion-item>
                        <ion-icon name="log-in-outline" slot="start" color="success"></ion-icon>
                        <ion-label>
                            <p>Hora de Entrada</p>
                            <h3>{{ entryTime || 'Sin fichar' }}</h3>
                        </ion-label>
                    </ion-item>
                    <ion-item>
                        <ion-icon name="log-out-outline" slot="start" color="danger"></ion-icon>
                        <ion-label>
                            <p>Hora de Salida</p>
                            <h3>{{ exitTime || 'Sin fichar' }}</h3>
                        </ion-label>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>

        <!-- Historial de Fichajes -->
        <ion-card>
            <ion-card-header>
                <ion-card-title>Historial de Fichajes</ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <ion-list *ngIf="history.length > 0">
                    <ion-item *ngFor="let shift of history">
                        <ion-icon name="location-outline" slot="start" color="tertiary"></ion-icon>
                        <ion-label>
                            <h2>{{ shift.date | date:'dd/MM/yyyy HH:mm' }}</h2>
                            <p>Lat: {{ shift.lat | number:'1.4-4' }} | Lng: {{ shift.lng | number:'1.4-4' }}</p>
                        </ion-label>
                        <ion-chip color="success" slot="end" outline="true">
                            <ion-label>Registrado</ion-label>
                        </ion-chip>
                    </ion-item>
                </ion-list>
                <div *ngIf="history.length === 0" class="ion-text-center ion-padding">
                    <p>No hay fichajes registrados.</p>
                </div>
            </ion-card-content>
        </ion-card>
    </div>
</ion-content>