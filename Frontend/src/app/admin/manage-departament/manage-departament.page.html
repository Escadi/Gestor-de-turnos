<ion-header class="ion-no-border">
  <ion-toolbar class="admin-toolbar">
    <ion-buttons slot="start">
      <ion-back-button default-href="/admin" class="btn-back"></ion-back-button>
    </ion-buttons>
    <ion-title>Gestión de Departamentos</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openAddModal()" class="btn-add-cat">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Nuevo Departamento
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding admin-content">

  <div class="list-title">Departamentos</div>

  <div class="categories-grid">
    <div *ngFor="let cat of departament" class="category-glass-card clickable" (click)="editCategory(cat)">
      <div class="card-indicator" [attr.data-level]="cat.accessLevel"></div>
      <div class="card-content">
        <div class="info">
          <h3>{{ cat.name }}</h3>
          <div class="access-tag" [attr.data-level]="cat.accessLevel">
            {{ cat.accessLevel || 'Empleado' }}
          </div>
        </div>
        <ion-icon name="chevron-forward-outline" class="detail-icon"></ion-icon>
      </div>
    </div>
  </div>

  <div *ngIf="departament.length === 0" class="empty-state">
    <ion-icon name="layers-outline"></ion-icon>
    <p>Cargando departamentos del sistema...</p>
  </div>

  <!-- PANEL DE EDICIÓN / ALTA (MODAL) -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()" class="admin-modal">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar>
          <ion-title>{{ editingId ? 'Configurar Departamento' : 'Nuevo Departamento' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()" color="medium">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding modal-bg">
        <div class="form-container">
          <div class="section-label">Ajustes del Puesto</div>

          <div class="input-block">
            <ion-item lines="none" class="premium-input">
              <ion-label position="stacked">Nombre del Departamento</ion-label>
              <ion-input [(ngModel)]="categoryData" placeholder="Ej: JEFE DE SALA"></ion-input>
            </ion-item>

            <ion-item lines="none" class="premium-input">
              <ion-label position="stacked">Nivel de Acceso al Sistema</ion-label>
              <ion-select [(ngModel)]="categoryData" interface="popover">
                <ion-select-option *ngFor="let dpto of departament" [value]="dpto.id">
                  {{ dpto.name }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <div class="modal-footer">
            <ion-button expand="block" (click)="saveCategory()" class="btn-save-cat">
              {{ editingId ? 'Actualizar Departamento' : 'Crear Nuevo Departamento' }}
            </ion-button>

            <ion-button *ngIf="editingId" expand="block" fill="clear" color="danger"
              (click)="deleteCategory(editingId)">
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Eliminar Departamento
            </ion-button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>